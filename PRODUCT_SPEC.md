# Продуктово-геймдизайнерское ТЗ  
## Игра 2048 (MVP для Яндекс.Игр)

---

## 1. Цель проекта

- Проверить пайплайн быстрого запуска игр на Яндекс.Игры  
- Сделать **дешёвый, быстрый MVP**
- Получить законченный, играбельный продукт без лишних фич

Проект **не про инновации** и **не про долгую поддержку**.  
Это проверка процесса и скорости.

---

## 2. Краткое описание игры

Классическая головоломка **2048**.

Игрок сдвигает плитки на поле 4×4, объединяя одинаковые значения,  
чтобы получить плитку 2048 и набрать максимальный счёт.

Игра продолжается, пока есть возможные ходы.

---

## 3. Основной игровой цикл (Core Loop)

1. Игрок делает ход (свайп или кнопка)
2. Плитки сдвигаются в выбранном направлении
3. Одинаковые плитки объединяются
4. Появляется новая плитка
5. Обновляется счёт
6. Проверяется конец игры
7. При проигрыше — экран Game Over → перезапуск

Цикл должен быть:
- быстрым
- понятным
- без лишних пауз

---

## 4. Правила игры

- Размер поля: **4×4**
- Старт:
  - 2 плитки со значением 2
- После каждого хода:
  - появляется 1 новая плитка  
  - чаще 2, реже 4 (90% / 10%)
- Плитка может объединяться **только один раз за ход**
- Игра заканчивается, когда нет доступных ходов
- Достижение 2048 считается успехом, но игра может продолжаться

---

## 5. Управление

- **Мобильные устройства** — свайпы (мин. расстояние 30–50px)
- **Компьютер** — стрелки на клавиатуре

Управление должно быть:
- интуитивным
- без обучения
- одинаково понятным на всех устройствах
- отзывчивым (input → реакция < 50ms)

---

## 6. Интерфейс (минимальный)

### Главный экран игры

На экране:
- Игровое поле 4×4
- Текущий счёт (Score)
- Лучший счёт (Best) — сохраняется локально (localStorage)
- Кнопка Restart

### Экран Game Over

- Надпись "Game Over"
- Финальный счёт
- Кнопка Restart

### Визуальный стиль (прототип)

**Для прототипа:**
- Плейсхолдеры: цветные прямоугольники
- Плитки: ColorRect с Label (значение плитки)
- Разные цвета для разных значений
- Без текстур и спрайтов

**Для финальной версии (позже):**
- UI графика и полировка
- Звуки (запуск только после user input)

Без меню, настроек и дополнительных экранов.

---

## 7. Анимации (приоритет)

Анимации критичны для ощущения игры.

### Движение плиток

- Длительность: **0.12–0.15 сек**
- Easing: ease-out (быстрый старт, плавная остановка)
- Плитки двигаются одновременно

### Слияние плиток

- Длительность: **0.1 сек**
- Эффект: scale up (1.0 → 1.1 → 1.0)
- После слияния — обновление значения

### Появление новой плитки

- Длительность: **0.1 сек**
- Эффект: scale up (0.0 → 1.0)
- Easing: ease-out

### Критичные требования

- Анимации **не блокируют** следующий ход
- Если анимация идёт — новый input в очередь или игнорируется
- Общее время анимаций за ход: **< 0.2 сек**

---

## 8. Монетизация (MVP)

- Используется **только полноэкранная реклама**
- Реклама показывается:
  - **после каждого Game Over**
- Перед показом рекламы:
  - Пауза игры
  - Пауза аудио (если есть)
- После рекламы:
  - Возврат к экрану Game Over
  - Игрок может нажать Restart
- Если реклама недоступна:
  - игра продолжается без неё
- Реклама не должна блокировать перезапуск игры

---

## 9. Интеграция Yandex SDK (критично)

### При запуске игры

1. Инициализация Yandex SDK
2. Вызов `ysdk.features.LoadingAPI.ready()` после загрузки
3. Если SDK недоступен (локальная разработка):
   - Игра работает без SDK
   - Логирование warning в консоль
   - Нет краша

### Показ рекламы

- Использовать `ysdk.adv.showFullscreenAdv()`
- Обработать callbacks:
  - `onOpen` → пауза игры и аудио
  - `onClose` → возобновление игры
  - `onError` → возобновление игры (без краша)

### Timeout

- Если реклама не отвечает > 5 сек → продолжить игру

---

## 10. Поведение в браузере

- Игра должна корректно работать:
  - на телефонах (iOS Safari, Android Chrome)
  - на компьютерах (Chrome, Firefox, Safari)
- При сворачивании вкладки:
  - игра не ломается
  - счёт не сбрасывается
- При ошибках (реклама, SDK и т.п.):
  - игра остаётся играбельной
- Работа по **HTTPS** (требование Yandex.Игры для production)

---

## 11. Осознанные ограничения

В игре **НЕ должно быть**:
- аккаунтов
- облачных сохранений
- лидербордов (для MVP)
- достижений
- мета-прогрессии
- уникальных механик
- кастомизации
- обучения (tutorial)

**Допустимо:**
- Локальное сохранение Best Score (localStorage)

Цель — **простота и завершённость**.

---

## 12. Звук и музыка (опционально, для финальной версии)

**Для прототипа:** без звука.

**Для финальной версии (позже):**

Если добавляется звук:
- Запуск **только после первого тапа/клика** (требование браузеров)
- Пауза при показе рекламы
- Пауза при сворачивании вкладки
- Без звука — игра остаётся играбельной

Звуки:
- Свайп/движение плиток (короткий)
- Слияние плиток (приятный)
- Game Over (нейтральный)

Музыка:
- Фоновая музыка (опционально)
- Возможность отключить

---

## 13. Критерии готовности (Definition of Done)

Игра считается готовой, если:

### Функциональность
- ✔ Запускается в браузере (Chrome, Firefox, Safari)
- ✔ В неё можно играть без объяснений
- ✔ Управление работает на телефоне и ПК
- ✔ Проигрыш определяется корректно
- ✔ Игра перезапускается
- ✔ Best Score сохраняется локально

### Yandex.Игры
- ✔ Вызван `gameReady()` после загрузки
- ✔ Реклама показывается после каждого Game Over
- ✔ Без рекламы игра работает (для локальной разработки)
- ✔ На production реклама интегрирована корректно

### Производительность
- ✔ Игра загружается **< 5 секунд**
- ✔ Стабильный **~60 FPS** на средних устройствах
- ✔ Нет зависаний и бесконечной загрузки

### Анимации
- ✔ Плитки плавно двигаются (0.12–0.15 сек)
- ✔ Плитки плавно появляются (0.1 сек)
- ✔ Слияние с эффектом (scale up)

### Стабильность
- ✔ Нет крашей при ошибках SDK/рекламы
- ✔ Игра не ломается при сворачивании вкладки
- ✔ Работает по HTTPS

---

## 14. Принципы реализации

- Делать просто
- Не усложнять
- Выбирать самое очевидное решение
- Главная цель — **рабочий результат**, а не идеальная архитектура
- Приоритет: **core loop** → анимации → интеграция SDK → полировка

---

## 15. Этапы разработки

### Этап 1: Прототип (приоритет)
- Логика игры (поле 4×4, слияние, счёт)
- Управление (свайпы, клавиатура)
- Анимации (движение, слияние, появление)
- Плейсхолдеры (ColorRect + Label)
- Проверка Game Over

### Этап 2: Yandex SDK
- Инициализация SDK
- `gameReady()` вызов
- Интеграция рекламы
- Обработка ошибок

### Этап 3: Полировка (опционально)
- UI графика
- Звуки
- Визуальные эффекты

---

## 16. Технические требования

- Engine: **Godot 4.6** (или 4.4 LTS)
- Export: **HTML5 (WebGL2)**
- Memory: **256–384 MB**
- Build size: **< 50 MB uncompressed** (< 15 MB with Brotli)
- Threads: **OFF**
- SharedArrayBuffer: **OFF**

См. также: `.cursor/skills/godot-export-yandex-games/`

---

## Контрольная сумма

Последнее обновление: 2026-02-03  
Версия ТЗ: 1.1 (дополнено по результатам аудита)
